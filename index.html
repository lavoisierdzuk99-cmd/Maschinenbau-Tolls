<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">

<script>
const moduleContainer = document.getElementById('module-container');

/* ----------------- SCHRAUBEN ------------------ */
const SCREW_AS={3:5.03,4:8.78,5:14.2,6:20.1,8:36.6,10:58.0,12:84.3,16:157,20:245,24:353};
const STRENGTH={"4.6":400,"5.8":500,"8.8":800,"10.9":1000,"12.9":1200};

function renderSchrauben(){
  const sizeOpts=Object.keys(SCREW_AS).map(d=>`<option value="${d}">M${d}</option>`).join('');
  const clsOpts=Object.keys(STRENGTH).map(k=>`<option>${k}</option>`).join('');
  moduleContainer.innerHTML=`
    <h3>ğŸ”© Schraubenrechner</h3>
    <div class="hint">Vorspannkraft aus Anziehdrehmoment (Lehr-NÃ¤herung).</div>
    <div class="grid">
      <div><label>GrÃ¶ÃŸe</label><select id="d_nom">${sizeOpts}</select></div>
      <div><label>Festigkeitsklasse</label><select id="klasse">${clsOpts}</select></div>
      <div><label>Anziehdrehmoment T [Nm]</label><input id="T" type="number" value="40"></div>
      <div><label>Reibkennwert K</label><input id="K" type="number" value="0.20" step="0.01"></div>
    </div>
    <button class="btn" onclick="calcBolt()">Berechnen</button>
    <div id="bolt-out" class="result"></div>`;
}

function calcBolt(){
  const d=+document.getElementById('d_nom').value;
  const T=+document.getElementById('T').value;
  const K=+document.getElementById('K').value;
  const Rm=STRENGTH[document.getElementById('klasse').value]||800;
  if(!(d>0&&T>=0&&K>0)) { document.getElementById('bolt-out').innerHTML="Bitte gÃ¼ltige Werte."; return; }
  const As=SCREW_AS[d]||0.6*(Math.PI*d*d/4);
  const Fv=(T*1000)/(K*d), Fzul=0.7*Rm*As, S=Fzul/Fv;
  const state=S<1?`<span class="warn">âš ï¸ Ãœberlast (S&lt;1)</span>`:S<1.5?`<span class="warn">âš ï¸ Hoch</span>`:`<span class="ok">âœ… OK</span>`;
  document.getElementById('bolt-out').innerHTML=
    `Asâ‰ˆ${As.toFixed(1)} mmÂ²<br>Fvâ‰ˆ<b>${Fv.toFixed(0)} N</b> Â· Fzulâ‰ˆ<b>${Fzul.toFixed(0)} N</b><br>Sâ‰ˆ<b>${S.toFixed(2)}</b> ${state}<br>
     Formeln: Fv=T/(KÂ·d), Fzul=0.7Â·RmÂ·As, S=Fzul/Fv`;
}

/* ----------------- BALKEN & TORSION ------------------ */
function renderBalken(){
  moduleContainer.innerHTML=`
    <h3>ğŸ“ Biegung &amp; Torsion</h3>
    <div class="hint">Vollrund. WÃ¤hle Fall, optional Torsion â†’ von Mises.</div>
    <div class="grid">
      <div><label>Fall</label>
        <select id="bcase" onchange="lbl()">
          <option value="ss_point">Einfach gelagert Â· Einzellast Mitte</option>
          <option value="ss_udl">Einfach gelagert Â· Gleichlast q</option>
          <option value="cant_point">Kragarm Â· Endlast</option>
          <option value="cant_udl">Kragarm Â· Gleichlast q</option>
        </select>
      </div>
      <div><label>LÃ¤nge L [m]</label><input id="L" type="number" value="1" step="0.1"></div>
      <div><label id="loadlbl">F [N] (Einzellast)</label><input id="F" type="number" value="100" step="10"></div>
      <div><label>Ã˜ d [mm]</label><input id="d_b" type="number" value="20"></div>
      <div><label>E [N/mmÂ²]</label><input id="E" type="number" value="210000"></div>
      <div><label>Torsion T [Nm] (opt.)</label><input id="Tt" type="number" value="0"></div>
    </div>
    <button class="btn" onclick="calcBeam()">Berechnen</button>
    <div id="beam-out" class="result"></div>`;
}

function lbl(){
  const isUdl = document.getElementById('bcase').value.includes('udl');
  document.getElementById('loadlbl').textContent = isUdl ? 'q [N/m] (Gleichlast)' : 'F [N] (Einzellast)';
}

function calcBeam(){
  const Lm=+document.getElementById('L').value;
  const Fq=+document.getElementById('F').value;
  const dmm=+document.getElementById('d_b').value;
  const E =+document.getElementById('E').value;
  const Tnm=+document.getElementById('Tt').value || 0;
  const c = document.getElementById('bcase').value;

  if([Lm,Fq,dmm,E].some(v=>!(v>0))) { document.getElementById('beam-out').innerHTML="Bitte gÃ¼ltige Werte."; return; }

  const L= Lm*1000, I=Math.PI*dmm**4/64, Wb=Math.PI*dmm**3/32, Wt=Math.PI*dmm**3/16;
  let M=0, f=0, txt="";
  if(c==='ss_point'){M=Fq*L/4; f=Fq*L**3/(48*E*I); txt="Einfach gelagert, Einzellast Mitte";}
  if(c==='ss_udl'){const q=Fq/1000; M=q*L*L/8; f=5*q*L**4/(384*E*I); txt="Einfach gelagert, Gleichlast";}
  if(c==='cant_point'){M=Fq*L; f=Fq*L**3/(3*E*I); txt="Kragarm, Endlast";}
  if(c==='cant_udl'){const q=Fq/1000; M=q*L*L/2; f=q*L**4/(8*E*I); txt="Kragarm, Gleichlast";}
  const sig_b=M/Wb, tau=Tnm? (Tnm*1000)/Wt : 0, sig_v=Math.sqrt(sig_b**2+3*tau**2);
  const rate=sig_v>250?`<span class="warn">âš ï¸ hoch</span>`:sig_v>150?`<span class="warn">âš ï¸ mittel</span>`:`<span class="ok">âœ… niedrig</span>`;
  document.getElementById('beam-out').innerHTML=
   `${txt}<br>M_maxâ‰ˆ${(M/1000).toFixed(2)} Nm Â· Ïƒ_bâ‰ˆ${sig_b.toFixed(1)} N/mmÂ² Â· fâ‰ˆ${f.toFixed(2)} mm<br>`+
   (tau?`Ï„_tâ‰ˆ${tau.toFixed(1)} N/mmÂ² Â· Ïƒ_vâ‰ˆ${sig_v.toFixed(1)} N/mmÂ² ${rate}<br>`:"")+
   `Formeln: Wb=Ï€dÂ³/32, Wt=Ï€dÂ³/16, Ïƒ_b=M/Wb, Ï„=T/Wt, Ïƒ_v=âˆš(Ïƒ_bÂ²+3Ï„Â²)`;
}

/* ----------------- WERKSTOFF ------------------ */
const MATERIALS=[
 {name:"S235JR",Rm:360,Re:235,rho:7850,E:210000,korrosion:"rostet",weld:"sehr gut",mach:"gut",apps:"Stahlbau",cost:1},
 {name:"C45E",Rm:700,Re:430,rho:7850,E:210000,korrosion:"rostet",weld:"eingeschrÃ¤nkt",mach:"gut",apps:"Wellen/Bolzen",cost:2},
 {name:"42CrMo4",Rm:900,Re:650,rho:7850,E:210000,korrosion:"rostet",weld:"bedingt",mach:"mittel",apps:"hochbelastete Teile",cost:3},
 {name:"AlMg3",Rm:300,Re:200,rho:2700,E:70000,korrosion:"gut",weld:"gut",mach:"sehr gut",apps:"Leichtbau",cost:2},
 {name:"1.4301",Rm:600,Re:230,rho:8000,E:200000,korrosion:"sehr gut",weld:"gut",mach:"zÃ¤h",apps:"Lebensmittel/Chemie",cost:4}
];
function renderWerkstoff(){
  const opts= MATERIALS.map((m,i)=>`<option value="${i}">${m.name}</option>`).join('');
  moduleContainer.innerHTML=`
    <h3>ğŸ§± Werkstoffvergleich</h3><div class="hint">Kennwerte + Kurzkommentar (Lehrzwecke).</div>
    <div class="grid">
      <div><label>Werkstoff 1</label><select id="m1"><option value="">â€“</option>${opts}</select></div>
      <div><label>Werkstoff 2</label><select id="m2"><option value="">â€“</option>${opts}</select></div>
      <div><label>Werkstoff 3</label><select id="m3"><option value="">â€“</option>${opts}</select></div>
    </div>
    <button class="btn" onclick="cmpMat()">Vergleichen</button>
    <div id="mat-out" class="result"></div>`;
}
function cmpMat(){
  const ids=[document.getElementById('m1').value,document.getElementById('m2').value,document.getElementById('m3').value].filter(v=>v!=="");
  if(!ids.length){ document.getElementById('mat-out').innerHTML="Bitte mindestens einen Werkstoff wÃ¤hlen."; return; }
  let html=`<table><tr><th>Werkstoff</th><th>Rm</th><th>Re</th><th>Ï</th><th>E</th><th>Korrosion</th><th>SchweiÃŸen</th><th>Zerspanung</th><th>Apps</th><th>â‚¬</th></tr>`;
  ids.forEach(v=>{const x=MATERIALS[+v];html+=`<tr><td>${x.name}</td><td>${x.Rm}</td><td>${x.Re}</td><td>${x.rho}</td><td>${x.E}</td><td>${x.korrosion}</td><td>${x.weld}</td><td>${x.mach}</td><td>${x.apps}</td><td>${x.cost}</td></tr>`});
  html+=`</table><br><span class="hint">Hinweis: gerundete Richtwerte â€“ fÃ¼r Auslegung DatenblÃ¤tter/Normen verwenden.</span>`;
  document.getElementById('mat-out').innerHTML=html;
}

/* ----------------- WELLE & LAGER ------------------ */
function renderWelle(){
  moduleContainer.innerHTML=`
    <h3>âš™ï¸ Welle &amp; Lager</h3>
    <div class="hint">Vollwelle, Torsion + optional Biegemoment â†’ von Mises.</div>
    <div class="grid">
      <div><label>Drehmoment T [Nm]</label><input id="Tw" type="number" value="200"></div>
      <div><label>Radialkraft F<sub>t</sub> [N] (opt.)</label><input id="Fz" type="number" value="0"></div>
      <div><label>Hebelarm a [m] (opt.)</label><input id="az" type="number" value="0.2" step="0.01"></div>
      <div><label>Ïƒ<sub>v,zul</sub> [N/mmÂ²]</label><input id="sv" type="number" value="120"></div>
    </div>
    <button class="btn" onclick="calcShaft()">Berechnen</button>
    <div id="shaft-out" class="result"></div>`;
}
function calcShaft(){
  const T=+document.getElementById('Tw').value;
  const F=+document.getElementById('Fz').value||0;
  const a=+document.getElementById('az').value||0;
  const zul=+document.getElementById('sv').value;
  if(!(T>0&&zul>0)) { document.getElementById('shaft-out').innerHTML="Bitte sinnvolle Werte."; return; }
  const Tmm=T*1000, Mb=(F>0&&a>0)?F*a*1000:0;
  const C=Math.sqrt((32*Mb/Math.PI)**2+3*(16*Tmm/Math.PI)**2);
  const d_req=Math.cbrt(C/zul);
  const prefs=[15,17,20,25,30,35,40,45,50,55,60]; let d_emp=prefs.find(p=>d_req<=p)||Math.ceil(d_req/5)*5;
  const lager=d=>d<=20?"6204/6205":d<=25?"6205":d<=30?"6206":d<=35?"6207":d<=40?"6208":d<=50?"6210":"DIN-Reihe wÃ¤hlen";
  const rate=d_req/d_emp<0.6?`<span class="ok">âœ… sicher</span>`:d_req/d_emp<0.9?`<span class="ok">âœ… passend</span>`:`<span class="warn">âš ï¸ grÃ¶ÃŸer wÃ¤hlen</span>`;
  document.getElementById('shaft-out').innerHTML=
   `d_req (Ïƒ_v)â‰ˆ<b>${d_req.toFixed(1)} mm</b> Â· d_empâ‰ˆ<b>${d_emp}</b> Â· Lager: <b>${lager(d_emp)}</b><br>`+
   (Mb?`Biegemomentâ‰ˆ${(Mb/1000).toFixed(1)} Nm<br>`:"")+rate+
   `<br>Formel: Ïƒ_v=âˆš((32Mb/Ï€dÂ³)Â²+3(16T/Ï€dÂ³)Â²) â‡’ d=(âˆš((32Mb/Ï€)Â²+3(16T/Ï€)Â²)/Ïƒ_v,zul)^(1/3)`;
}

/* ----------------- ISO-PASSUNG (erweitert â€“ Lehrmodell) --------------- */
function IT_um(D,grade){const i=0.45*Math.cbrt(D)+0.001*D;const K={5:7,6:10,7:16,8:25,9:40,10:64,11:100}[grade];return K?K*i:null;}
const HOLE_SHIFT={F:-1.0,G:-0.5,H:0,J:0.5,K:1.0,M:2.0,N:2.5,P:3.0,S:4.0,U:5.0};
const SHAFT_SHIFT={f:-1.0,g:-0.5,h:0,js:0,k:0.5,m:1.0,n:1.5,p:2.5,s:4.0,u:5.0};

function renderPassung(){
  moduleContainer.innerHTML=`
    <h3>ğŸ§· ISO-Passung (erweitert)</h3>
    <div class="hint">Lehr-NÃ¤herung: IT nach i-Formel, GrundabmaÃŸe als Vielfache der IT verschoben. FÃ¼r Fertigung ISO-286 Tabellen nutzen.</div>
    <div class="grid">
      <div><label>Nenndurchmesser D [mm]</label><input id="Dfit" type="number" value="20"></div>
      <div><label>IT Loch</label><select id="IT_hole"><option>5</option><option>6</option><option selected>7</option><option>8</option><option>9</option><option>10</option><option>11</option></select></div>
      <div><label>IT Welle</label><select id="IT_shaft"><option>5</option><option selected>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option></select></div>
      <div><label>Loch-Toleranzfeld</label><select id="Hlett">${Object.keys(HOLE_SHIFT).map(x=>`<option ${x==='H'?'selected':''}>${x}</option>`).join('')}</select></div>
      <div><label>Wellen-Toleranzfeld</label><select id="Slett">${Object.keys(SHAFT_SHIFT).map(x=>`<option ${x==='h'?'selected':''}>${x}</option>`).join('')}</select></div>
    </div>
    <button class="btn" onclick="calcFit()">Passung berechnen</button>
    <div id="fit-out" class="result"></div>`;
}

function calcFit(){
  const D=+document.getElementById('Dfit').value;
  const gH=+document.getElementById('IT_hole').value;
  const gS=+document.getElementById('IT_shaft').value;
  const LH=document.getElementById('Hlett').value;
  const LS=document.getElementById('Slett').value;

  if(!(D>0)) { document.getElementById('fit-out').innerHTML="Bitte gÃ¼ltigen Nenndurchmesser."; return; }
  const IT_H=IT_um(D,gH), IT_S=IT_um(D,gS); if(!IT_H||!IT_S){ document.getElementById('fit-out').innerHTML="IT nicht unterstÃ¼tzt."; return; }

  const zH=(HOLE_SHIFT[LH]??0), EI_H=zH*IT_H, ES_H=EI_H+IT_H;
  let ei_S, es_S;
  if(LS==='h'){es_S=0; ei_S=-IT_S;}
  else if(LS==='js'){es_S= IT_S/2; ei_S= -IT_S/2;}
  else {const zS=(SHAFT_SHIFT[LS]??0); es_S=zS*IT_S; ei_S=es_S-IT_S;}

  const hole_min=D+EI_H/1000, hole_max=D+ES_H/1000, shaft_min=D+ei_S/1000, shaft_max=D+es_S/1000;
  const cmin=(hole_min-shaft_max)*1000, cmax=(hole_max-shaft_min)*1000;
  let typ = cmin>0?`<span class="ok">âœ… Spielpassung</span>` : (cmax<0?`<span class="warn">âš ï¸ ÃœbermaÃŸpassung</span>`:`<span class="warn">âš ï¸ Ãœbergangspassung</span>`);
  document.getElementById('fit-out').innerHTML=
   `<b>${LH}${gH} / ${LS}${gS}</b> bei D=${D.toFixed(2)} mm<br><br>`+
   `Loch: EI=${EI_H.toFixed(0)} Âµm, ES=${ES_H.toFixed(0)} Âµm â†’ ${hole_min.toFixed(3)}â€¦${hole_max.toFixed(3)} mm<br>`+
   `Welle: ei=${ei_S.toFixed(0)} Âµm, es=${es_S.toFixed(0)} Âµm â†’ ${shaft_min.toFixed(3)}â€¦${shaft_max.toFixed(3)} mm<br><br>`+
   `Spiel: c_minâ‰ˆ${cmin.toFixed(0)} Âµm, c_maxâ‰ˆ${cmax.toFixed(0)} Âµm â†’ ${typ}<br><br>`+
   `<span class="hint">Lehr-Modell (Zero-Line-Shift in IT-Vielfachen). FÃ¼r die Fertigung ISO-286-Tabellen verwenden.</span>`;
}

/* ----------------- KOSTEN ------------------ */
function renderKosten(){
  moduleContainer.innerHTML=`
    <h3>ğŸ’° Kosten</h3><div class="hint">Einfache Teilekalkulation.</div>
    <div class="grid">
      <div><label>Volumen V [cmÂ³]</label><input id="V" type="number" value="100"></div>
      <div><label>Ï [g/cmÂ³]</label><input id="ro" type="number" value="7.85"></div>
      <div><label>Materialpreis [â‚¬/kg]</label><input id="cm" type="number" value="2"></div>
      <div><label>Fertigungszeit [min]</label><input id="t" type="number" value="10"></div>
      <div><label>Maschinen-â‚¬/h</label><input id="ch" type="number" value="60"></div>
      <div><label>StÃ¼ckzahl</label><input id="n" type="number" value="10"></div>
    </div>
    <button class="btn" onclick="cost()">Berechnen</button>
    <div id="cost-out" class="result"></div>`;
}
function cost(){
  const V=+document.getElementById('V').value, ro=+document.getElementById('ro').value, cm=+document.getElementById('cm').value,
        t=+document.getElementById('t').value, ch=+document.getElementById('ch').value, n=+document.getElementById('n').value;
  if([V,ro,cm,t,ch,n].some(v=>!(v>=0))) { document.getElementById('cost-out').innerHTML="Bitte sinnvolle Werte."; return; }
  const m=V*ro/1000, Kmat=m*cm, Kfert=(t/60)*ch, Kteil=Kmat+Kfert, Kges=Kteil*n;
  document.getElementById('cost-out').innerHTML=`mâ‰ˆ${m.toFixed(3)} kg Â· K_matâ‰ˆ${Kmat.toFixed(2)} â‚¬ Â· K_fertâ‰ˆ${Kfert.toFixed(2)} â‚¬<br>
  K_teilâ‰ˆ<b>${Kteil.toFixed(2)} â‚¬</b> Â· K_gesâ‰ˆ<b>${Kges.toFixed(2)} â‚¬</b>`;
}

/* ----------------- WÃ„RME ------------------ */
function renderWaerme(){
  moduleContainer.innerHTML=`
    <h3>ğŸ”¥ WÃ¤rme</h3><div class="hint">Einlagige Wand, Konvektion innen/auÃŸen.</div>
    <div class="grid">
      <div><label>T<sub>i</sub> [Â°C]</label><input id="Ti" type="number" value="20"></div>
      <div><label>T<sub>o</sub> [Â°C]</label><input id="To" type="number" value="0"></div>
      <div><label>Î´ [m]</label><input id="del" type="number" value="0.2" step="0.01"></div>
      <div><label>Î» [W/mK]</label><input id="lam" type="number" value="0.2" step="0.01"></div>
      <div><label>h<sub>i</sub> [W/mÂ²K]</label><input id="hi" type="number" value="8"></div>
      <div><label>h<sub>o</sub> [W/mÂ²K]</label><input id="ho" type="number" value="20"></div>
      <div><label>A [mÂ²]</label><input id="A" type="number" value="10"></div>
    </div>
    <button class="btn" onclick="heat()">Berechnen</button>
    <div id="heat-out" class="result"></div>`;
}
function heat(){
  const Ti=+document.getElementById('Ti').value, To=+document.getElementById('To').value,
        del=+document.getElementById('del').value, lam=+document.getElementById('lam').value,
        hi=+document.getElementById('hi').value, ho=+document.getElementById('ho').value, A=+document.getElementById('A').value;
  if([Ti,To,del,lam,hi,ho,A].some(v=>!(v>0))) { document.getElementById('heat-out').innerHTML="Bitte alle Werte > 0."; return; }
  const Rsi=1/hi,Rse=1/ho,Rw=del/lam,R=Rsi+Rw+Rse,U=1/R,Q=U*A*(Ti-To);
  document.getElementById('heat-out').innerHTML=`Uâ‰ˆ<b>${U.toFixed(3)} W/mÂ²K</b> Â· Qâ‰ˆ<b>${Q.toFixed(1)} W</b><br>Formeln: R=1/h; R_w=Î´/Î»; U=1/Î£R; Q=UÂ·AÂ·Î”T`;
}

/* ----------------- NAV ------------------ */
function setActive(btn){document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));btn.classList.add('active')}
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    setActive(btn);
    const m=btn.dataset.module;
    if(m==='schraube') renderSchrauben();
    else if(m==='balken') renderBalken();
    else if(m==='werkstoff') renderWerkstoff();
    else if(m==='welle') renderWelle();
    else if(m==='passung') renderPassung();
    else if(m==='kosten') renderKosten();
    else if(m==='waerme') renderWaerme();
  })
});
renderSchrauben();
</script>
