<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Engineering Toolkit</title>
  <style>
    :root {
      --bg: #0f172a;
      --accent: #38bdf8;
      --border-soft: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97316;
      --ok: #22c55e;
      --radius: 14px;
      --shadow: 0 16px 40px rgba(15,23,42,0.55);
      --font: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font);
      background: radial-gradient(circle at top, #111827 0, #020817 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 18px 26px 14px;
      border-bottom: 1px solid rgba(148,163,253,0.08);
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent),
        radial-gradient(circle at top right, rgba(79,70,229,0.16), transparent),
        rgba(2,6,23,0.96);
      backdrop-filter: blur(16px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.logo-pill {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.35);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    header .sub {
      margin-top: 4px;
      font-size: 0.82rem;
      color: var(--muted);
    }

    .shell {
      display: flex;
      flex-direction: column;
      padding: 16px;
      max-width: 1180px;
      margin: 0 auto 24px;
      gap: 10px;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.96), rgba(2,6,23,1));
      border: 1px solid rgba(148,163,253,0.16);
      box-shadow: 0 14px 40px rgba(15,23,42,0.65);
      align-items: center;
    }

    nav button {
      padding: 6px 11px;
      cursor: pointer;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.18s ease;
    }

    nav button span.icon { font-size: 0.9rem; }

    nav button:hover {
      color: var(--accent);
      border-color: rgba(56,189,248,0.35);
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(2,6,23,1));
    }

    nav button.active {
      background: linear-gradient(to right, rgba(56,189,248,0.16), rgba(79,70,229,0.22));
      color: var(--text);
      border-color: rgba(129,140,248,0.7);
      box-shadow: 0 6px 16px rgba(15,23,42,0.85);
    }

    .card {
      margin-top: 10px;
      padding: 18px 18px 16px;
      border-radius: var(--radius);
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.06), transparent),
        radial-gradient(circle at top right, rgba(79,70,229,0.06), transparent),
        rgba(6,9,20,0.98);
      border: 1px solid rgba(75,85,99,0.6);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      min-height: 180px;
    }

    h3 { margin: 0 0 4px; font-size: 1.05rem; font-weight: 500; color: #e5e7ff; }
    .hint { font-size: 0.78rem; color: var(--muted); margin-bottom: 10px; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 10px 16px;
      margin-top: 4px;
    }

    .field { margin-bottom: 4px; }

    label {
      display: block;
      font-size: 0.74rem;
      margin-bottom: 2px;
      color: var(--muted);
    }

    input, select {
      padding: 6px 7px;
      width: 100%;
      border-radius: 7px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(9,9,18,0.98);
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
      transition: all 0.16s ease;
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.25);
      background: #020817;
    }

    .btn-primary {
      margin-top: 8px;
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(to right, var(--accent), #6366f1);
      color: #0b1020;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.9);
      transition: all 0.18s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(15,23,42,0.95);
    }

    .result {
      margin-top: 10px;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid rgba(75,85,99,0.9);
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(1,4,12,1));
      font-size: 0.8rem;
      color: var(--text);
      line-height: 1.5;
      white-space: normal;
      overflow-x: auto;
    }

    .pill-ok { color: var(--ok); font-weight: 500; }
    .pill-warn { color: var(--danger); font-weight: 500; }
    .pill-note { color: var(--muted); font-size: 0.72rem; }

    table {
      border-collapse: collapse;
      margin-top: 8px;
      width: 100%;
      font-size: 0.75rem;
    }
    th, td {
      border: 1px solid rgba(75,85,99,0.9);
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background: rgba(15,23,42,0.96);
      color: var(--muted);
      font-weight: 500;
    }

    @media (max-width: 700px) {
      header { padding: 14px 14px 10px; }
      .shell { padding: 10px; }
      .card { padding: 14px; }
      nav { border-radius: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <span class="logo-pill">ENG KIT</span>
      Engineering Toolkit
    </h1>
    <div class="sub">
      Kompakte technische Rechner fÃ¼r Studium & Praxis â€“ mit sichtbaren Formeln und ErklÃ¤rungen.
    </div>
  </header>

  <div class="shell">
    <nav>
      <button data-module="schraube" class="active"><span class="icon">ğŸ”©</span>Schrauben</button>
      <button data-module="balken"><span class="icon">ğŸ“</span>Biegung &amp; Torsion</button>
      <button data-module="werkstoff"><span class="icon">ğŸ§±</span>Werkstoffe</button>
      <button data-module="welle"><span class="icon">âš™ï¸</span>Welle &amp; Lager</button>
      <button data-module="passung"><span class="icon">ğŸ§·</span>ISO-Passung</button>
      <button data-module="kosten"><span class="icon">ğŸ’°</span>Kosten</button>
      <button data-module="waerme"><span class="icon">ğŸ”¥</span>WÃ¤rme</button>
    </nav>

    <div class="card">
      <div id="module-container"></div>
    </div>
  </div>

  <script>
    const moduleContainer = document.getElementById('module-container');

    // ==========================================================
    // ğŸ”© SCHRAUBENRECHNER (erweitert)
    // ==========================================================
    const SCREW_AS = {
      3: 5.03, 4: 8.78, 5: 14.2, 6: 20.1, 8: 36.6,
      10: 58.0, 12: 84.3, 16: 157, 20: 245, 24: 353
    };

    const STRENGTH_CLASSES = {
      "4.6": { Rm: 400 },
      "5.8": { Rm: 500 },
      "8.8": { Rm: 800 },
      "10.9": { Rm: 1000 },
      "12.9": { Rm: 1200 }
    };

    function renderSchraubenrechner() {
      const sizeOptions = Object.keys(SCREW_AS)
        .map(d => `<option value="${d}">M${d}</option>`).join("");
      const classOptions = Object.keys(STRENGTH_CLASSES)
        .map(k => `<option value="${k}">${k}</option>`).join("");

      moduleContainer.innerHTML = `
        <h3>ğŸ”© Schraubenrechner</h3>
        <div class="hint">
          Vorspannkraft aus Anziehdrehmoment nach einfacher Ingenieur-NÃ¤herung.
          Gut als Lern- und VorabschÃ¤tzungstool.
        </div>
        <div class="grid">
          <div class="field">
            <label>SchraubengrÃ¶ÃŸe</label>
            <select id="d_nom">${sizeOptions}</select>
          </div>
          <div class="field">
            <label>Festigkeitsklasse</label>
            <select id="klasse">${classOptions}</select>
          </div>
          <div class="field">
            <label>Anziehdrehmoment T [Nm]</label>
            <input id="torque" type="number" value="40" />
          </div>
          <div class="field">
            <label>Reibkennwert K (typisch 0.18â€“0.25)</label>
            <input id="K_fric" type="number" value="0.20" step="0.01" />
          </div>
        </div>
        <button class="btn-primary" onclick="calcBolt()">Berechnen</button>
        <div id="bolt-result" class="result"></div>
      `;
    }

    function calcBolt() {
      const d = parseFloat(document.getElementById('d_nom').value);
      const klasse = document.getElementById('klasse').value;
      const T_Nm = parseFloat(document.getElementById('torque').value);
      const K = parseFloat(document.getElementById('K_fric').value);

      if (isNaN(d) || isNaN(T_Nm) || isNaN(K) || K <= 0) {
        document.getElementById('bolt-result').innerHTML = "Bitte gÃ¼ltige Werte eingeben.";
        return;
      }

      const As = SCREW_AS[d] || 0.6 * (Math.PI * d * d / 4);
      const Rm = (STRENGTH_CLASSES[klasse] || {Rm:800}).Rm;

      const T_Nmm = T_Nm * 1000;
      const Fv = T_Nmm / (K * d);          // [N]
      const Fzul = 0.7 * Rm * As;          // [N]
      const S = Fzul / Fv;

      let state;
      if (S < 1) state = `<span class="pill-warn">âš ï¸ Ãœberlastgefahr (S &lt; 1).</span>`;
      else if (S < 1.5) state = `<span class="pill-warn">âš ï¸ Hohe Auslastung â€“ in der Praxis genau prÃ¼fen.</span>`;
      else state = `<span class="pill-ok">âœ… Aus dieser NÃ¤herung heraus im sicheren Bereich.</span>`;

      document.getElementById('bolt-result').innerHTML = `
        <b>Eingaben:</b> M${d}, Klasse ${klasse}, T = ${T_Nm.toFixed(1)} Nm, K = ${K.toFixed(2)}<br>
        Spannungsquerschnitt As â‰ˆ ${As.toFixed(1)} mmÂ²<br><br>
        Vorspannkraft Fv â‰ˆ <b>${Fv.toFixed(0)} N</b><br>
        zul. Vorspannkraft Fzul â‰ˆ <b>${Fzul.toFixed(0)} N</b><br>
        Sicherheitsfaktor S â‰ˆ <b>${S.toFixed(2)}</b><br>
        ${state}<br><br>
        <b>Formeln:</b><br>
        Fv = T / (K Â· d)  (T in Nmm, d in mm)<br>
        Fzul = 0.7 Â· Rm Â· As<br>
        S = Fzul / Fv<br><br>
        <span class="pill-note">NÃ¤herung fÃ¼r Schulung/Vordimensionierung. FÃ¼r reale Projekte Normen & Herstellerangaben verwenden.</span>
      `;
    }

    // ==========================================================
    // ğŸ“ BIEGUNG & TORSION â€“ mehrere FÃ¤lle + von Mises
    // ==========================================================
    function renderBalken() {
      moduleContainer.innerHTML = `
        <h3>ğŸ“ Biegung &amp; Torsion</h3>
        <div class="hint">
          Vollrundquerschnitt, mehrere StandardfÃ¤lle. Alle Rechnungen in mm/N.
          Optional: Torsionsmoment â†’ Vergleichsspannung nach von Mises.
        </div>
        <div class="grid">
          <div class="field">
            <label>Belastungsfall</label>
            <select id="beamCase" onchange="updateBeamLoadLabel()">
              <option value="ss_point">Einfach gelagert, Einzellast in der Mitte</option>
              <option value="ss_udl">Einfach gelagert, Gleichlast q</option>
              <option value="cant_point">Kragarm, Endlast</option>
              <option value="cant_udl">Kragarm, Gleichlast q</option>
            </select>
          </div>
          <div class="field">
            <label>LÃ¤nge L [m]</label>
            <input id="L" type="number" step="0.1" value="1.0" />
          </div>
          <div class="field">
            <label id="load-label">F [N] (Einzellast)</label>
            <input id="F" type="number" step="10" value="100" />
          </div>
          <div class="field">
            <label>Durchmesser d [mm]</label>
            <input id="d_b" type="number" step="1" value="20" />
          </div>
          <div class="field">
            <label>E-Modul [N/mmÂ²]</label>
            <input id="E" type="number" value="210000" />
          </div>
          <div class="field">
            <label>Torsionsmoment T [Nm] (optional)</label>
            <input id="T_tors" type="number" step="10" value="0" />
          </div>
        </div>
        <button class="btn-primary" onclick="calcBeam()">Berechnen</button>
        <div id="beam-result" class="result"></div>
      `;
    }

    function updateBeamLoadLabel() {
      const c = document.getElementById('beamCase').value;
      const lbl = document.getElementById('load-label');
      if (c === 'ss_point' || c === 'cant_point') {
        lbl.textContent = 'F [N] (Einzellast)';
      } else {
        lbl.textContent = 'q [N/m] (gleichmÃ¤ÃŸig verteilte Last)';
      }
    }

    function calcBeam() {
      const L_m = parseFloat(document.getElementById('L').value);
      const F_or_q = parseFloat(document.getElementById('F').value);
      const d = parseFloat(document.getElementById('d_b').value);
      const E = parseFloat(document.getElementById('E').value);
      const T_Nm = parseFloat(document.getElementById('T_tors').value) || 0;
      const beamCase = document.getElementById('beamCase').value;

      if ([L_m, F_or_q, d, E].some(v => isNaN(v) || v <= 0)) {
        document.getElementById('beam-result').innerHTML = "Bitte alle Werte > 0 eingeben.";
        return;
      }

      const L_mm = L_m * 1000;
      const I = Math.PI * Math.pow(d, 4) / 64;   // mm^4
      const Wb = Math.PI * Math.pow(d, 3) / 32;  // mm^3
      const Wt = Math.PI * Math.pow(d, 3) / 16;  // mm^3

      let M_max_Nmm = 0;
      let sigma_b = 0;
      let f_mm = 0;
      let caseText = "";
      let formulaText = "";

      if (beamCase === 'ss_point') {
        const F = F_or_q;
        M_max_Nmm = F * L_mm / 4;
        sigma_b = M_max_Nmm / Wb;
        f_mm = F * Math.pow(L_mm, 3) / (48 * E * I);
        caseText = "Einfach gelagert, Einzellast in der Mitte.";
        formulaText = "M_max = FÂ·L/4;  Ïƒ_b = M_max/W_b;  f_max = FÂ·LÂ³/(48Â·EÂ·I)";
      } else if (beamCase === 'ss_udl') {
        const q = F_or_q; // N/m
        const q_mm = q / 1000; // N/mm
        M_max_Nmm = q_mm * L_mm * L_mm / 8;
        sigma_b = M_max_Nmm / Wb;
        f_mm = 5 * q_mm * Math.pow(L_mm, 4) / (384 * E * I);
        caseText = "Einfach gelagert, gleichmÃ¤ÃŸig verteilte Last.";
        formulaText = "M_max = qÂ·LÂ²/8;  Ïƒ_b = M_max/W_b;  f_max = 5Â·qÂ·Lâ´/(384Â·EÂ·I)";
      } else if (beamCase === 'cant_point') {
        const F = F_or_q;
        M_max_Nmm = F * L_mm;
        sigma_b = M_max_Nmm / Wb;
        f_mm = F * Math.pow(L_mm, 3) / (3 * E * I);
        caseText = "Kragarm, Endlast.";
        formulaText = "M_max = FÂ·L;  Ïƒ_b = M_max/W_b;  f_max = FÂ·LÂ³/(3Â·EÂ·I)";
      } else if (beamCase === 'cant_udl') {
        const q = F_or_q;
        const q_mm = q / 1000;
        M_max_Nmm = q_mm * L_mm * L_mm / 2;
        sigma_b = M_max_Nmm / Wb;
        f_mm = q_mm * Math.pow(L_mm, 4) / (8 * E * I);
        caseText = "Kragarm, gleichmÃ¤ÃŸig verteilte Last.";
        formulaText = "M_max = qÂ·LÂ²/2;  Ïƒ_b = M_max/W_b;  f_max = qÂ·Lâ´/(8Â·EÂ·I)";
      }

      outputBeam(M_max_Nmm, sigma_b, f_mm, T_Nm, Wt, caseText, formulaText);
    }

    function outputBeam(M_max_Nmm, sigma_b, f_mm, T_Nm, Wt, caseText, formulaText) {
      const M_max_Nm = M_max_Nmm / 1000;

      let tau_t = 0;
      if (T_Nm && T_Nm !== 0) {
        const T_Nmm = T_Nm * 1000;
        tau_t = T_Nmm / Wt;
      }

      const sigma_v = Math.sqrt(sigma_b * sigma_b + 3 * tau_t * tau_t);

      let rating;
      if (sigma_v > 250) rating = `<span class="pill-warn">âš ï¸ Hohe Vergleichsspannung â€“ Querschnitt vermutlich zu klein.</span>`;
      else if (sigma_v > 150) rating = `<span class="pill-warn">âš ï¸ Mittlere bis hohe Auslastung â€“ genauer prÃ¼fen.</span>`;
      else rating = `<span class="pill-ok">âœ… Geringe bis moderate Auslastung (fÃ¼r Baustahl, NÃ¤herung).</span>`;

      document.getElementById('beam-result').innerHTML = `
        ${caseText}<br><br>
        M_max â‰ˆ ${M_max_Nm.toFixed(2)} Nm<br>
        Ïƒ_b,max â‰ˆ ${sigma_b.toFixed(1)} N/mmÂ²<br>
        f_max â‰ˆ ${f_mm.toFixed(2)} mm<br>
        ${T_Nm ? `Ï„_t,max â‰ˆ ${tau_t.toFixed(1)} N/mmÂ²<br>` : ""}
        ${T_Nm ? `Ïƒ_v (von Mises) â‰ˆ ${sigma_v.toFixed(1)} N/mmÂ²<br>` : ""}
        ${rating}<br><br>
        <b>Formeln (Vollrund, linear-elastisch):</b><br>
        W_b = Ï€Â·dÂ³/32;  W_t = Ï€Â·dÂ³/16<br>
        Ïƒ_b = M_max / W_b;  Ï„_t = T / W_t;<br>
        Ïƒ_v = âˆš(Ïƒ_bÂ² + 3Â·Ï„_tÂ²)<br>
        ${formulaText}<br><br>
        <span class="pill-note">Nur StandardfÃ¤lle. FÃ¼r komplexe Systeme (mehrere Lasten/Lager) vollstÃ¤ndige Festigkeitslehre anwenden.</span>
      `;
    }

    // ==========================================================
    // ğŸ§± WERKSTOFFVERGLEICH â€“ erweitert
    // ==========================================================
    const MATERIALS = [
      {
        name: "S235JR (Baustahl)",
        Rm: 360, Re: 235, rho: 7850, E: 210000,
        korrosion: "rostet ohne Schutz",
        kosten: 1,
        weld: "sehr gut",
        mach: "gut",
        apps: "Stahlbau, TrÃ¤ger, einfache Maschinenteile"
      },
      {
        name: "C45E (VergÃ¼tungsstahl)",
        Rm: 700, Re: 430, rho: 7850, E: 210000,
        korrosion: "rostet",
        kosten: 2,
        weld: "eingeschrÃ¤nkt",
        mach: "gut",
        apps: "Wellen, Bolzen, Kurbelhebel"
      },
      {
        name: "42CrMo4 (hochfest)",
        Rm: 900, Re: 650, rho: 7850, E: 210000,
        korrosion: "rostet",
        kosten: 3,
        weld: "bedingt",
        mach: "mittel",
        apps: "ZahnrÃ¤der, hochbelastete Wellen"
      },
      {
        name: "AlMg3 (Al-Legierung)",
        Rm: 300, Re: 200, rho: 2700, E: 70000,
        korrosion: "gut",
        kosten: 2,
        weld: "gut",
        mach: "sehr gut",
        apps: "Leichtbau, GehÃ¤use, Fahrzeugteile"
      },
      {
        name: "1.4301 (V2A, CrNi-Stahl)",
        Rm: 600, Re: 230, rho: 8000, E: 200000,
        korrosion: "sehr gut",
        kosten: 4,
        weld: "gut",
        mach: "zÃ¤h",
        apps: "Lebensmittel, Chemie, AuÃŸeneinsatz"
      }
    ];

    function renderWerkstoffvergleich() {
      const options = MATERIALS.map((m, i) => `<option value="${i}">${m.name}</option>`).join("");
      moduleContainer.innerHTML = `
        <h3>ğŸ§± Werkstoffvergleich</h3>
        <div class="hint">
          Vergleich wichtiger Kennwerte + Kurzkommentar. Ideal als LernÃ¼bersicht.
        </div>
        <div class="grid">
          <div class="field">
            <label>Werkstoff 1</label>
            <select id="mat1"><option value="">â€“</option>${options}</select>
          </div>
          <div class="field">
            <label>Werkstoff 2</label>
            <select id="mat2"><option value="">â€“</option>${options}</select>
          </div>
          <div class="field">
            <label>Werkstoff 3</label>
            <select id="mat3"><option value="">â€“</option>${options}</select>
          </div>
        </div>
        <button class="btn-primary" onclick="calcMaterials()">Vergleichen</button>
        <div id="mat-result" class="result"></div>
      `;
    }

    function calcMaterials() {
      const ids = ["mat1", "mat2", "mat3"]
        .map(id => document.getElementById(id).value)
        .filter(v => v !== "");

      if (!ids.length) {
        document.getElementById('mat-result').innerHTML = "Bitte mindestens einen Werkstoff auswÃ¤hlen.";
        return;
      }

      let html = `<table>
        <tr>
          <th>Werkstoff</th>
          <th>Rm</th>
          <th>Re</th>
          <th>Dichte</th>
          <th>E</th>
          <th>Korrosion</th>
          <th>SchweiÃŸen</th>
          <th>Zerspanung</th>
          <th>Typische Anwendungen</th>
          <th>Kostenfaktor</th>
        </tr>`;

      ids.forEach(v => {
        const m = MATERIALS[parseInt(v)];
        html += `
          <tr>
            <td>${m.name}</td>
            <td>${m.Rm} N/mmÂ²</td>
            <td>${m.Re} N/mmÂ²</td>
            <td>${m.rho} kg/mÂ³</td>
            <td>${m.E} N/mmÂ²</td>
            <td>${m.korrosion}</td>
            <td>${m.weld}</td>
            <td>${m.mach}</td>
            <td>${m.apps}</td>
            <td>${m.kosten}</td>
          </tr>`;
      });

      html += `</table>
        <br>
        <b>Werkstofftechnik-Kurzfassung:</b><br>
        â€¢ Unlegierte BaustÃ¤hle: preiswert, gut schweiÃŸbar â†’ Strukturbauteile, aber begrenzte Festigkeit.<br>
        â€¢ VergÃ¼tungsstÃ¤hle (C45, 42CrMo4): durch WÃ¤rmebehandlung hohe Festigkeit â†’ Wellen, Getriebeteile.<br>
        â€¢ Al-Legierungen: geringes Gewicht, geringes E â†’ grÃ¶ÃŸere Durchbiegung beachten, gut fÃ¼r Leichtbau.<br>
        â€¢ Rostfreie StÃ¤hle: hohe KorrosionsbestÃ¤ndigkeit, teurer, zÃ¤her in der Bearbeitung.<br><br>
        <span class="pill-note">Werte gerundet. FÃ¼r Auslegung immer DatenblÃ¤tter / Normen heranziehen.</span>
      `;
      document.getElementById('mat-result').innerHTML = html;
    }

    // ==========================================================
    // âš™ï¸ WELLE & LAGER â€“ Torsion + Biegung + von Mises
    // ==========================================================
    function renderWelle() {
      moduleContainer.innerHTML = `
        <h3>âš™ï¸ Welle &amp; Lager</h3>
        <div class="hint">
          Vordimensionierung einer Vollwelle aus Torsion und optionalem Biegemoment (z.B. Zahnradkraft).
          Nutzt Vergleichsspannung nach von Mises.
        </div>
        <div class="grid">
          <div class="field">
            <label>Drehmoment T [Nm]</label>
            <input id="T_welle" type="number" value="200" />
          </div>
          <div class="field">
            <label>Radialkraft F<sub>t</sub> am Zahnrad [N] (optional)</label>
            <input id="F_gear" type="number" value="0" />
          </div>
          <div class="field">
            <label>Hebelarm a von Lager zu Zahnrad [m] (optional)</label>
            <input id="a_gear" type="number" value="0.2" step="0.01" />
          </div>
          <div class="field">
            <label>zul. Vergleichsspannung Ïƒ<sub>v,zul</sub> [N/mmÂ²]</label>
            <input id="sigma_v_zul" type="number" value="120" />
          </div>
        </div>
        <button class="btn-primary" onclick="calcShaft()">Berechnen</button>
        <div id="shaft-result" class="result"></div>
      `;
    }

    function calcShaft() {
      const T_Nm = parseFloat(document.getElementById('T_welle').value);
      const F_gear = parseFloat(document.getElementById('F_gear').value) || 0;
      const a_gear_m = parseFloat(document.getElementById('a_gear').value) || 0;
      const sigma_v_zul = parseFloat(document.getElementById('sigma_v_zul').value);

      if (isNaN(T_Nm) || T_Nm <= 0 || isNaN(sigma_v_zul) || sigma_v_zul <= 0) {
        document.getElementById('shaft-result').innerHTML = "Bitte mindestens T und Ïƒ_v,zul sinnvoll eingeben.";
        return;
      }

      const T_Nmm = T_Nm * 1000;
      const M_b_Nmm = (F_gear > 0 && a_gear_m > 0) ? F_gear * a_gear_m * 1000 : 0;

      // Koeffizient fÃ¼r Vergleichsspannung:
      // Ïƒ_b = 32 M_b / (Ï€ dÂ³), Ï„_t = 16 T / (Ï€ dÂ³)
      // Ïƒ_v = sqrt(Ïƒ_bÂ² + 3 Ï„_tÂ²) = (1/dÂ³) * sqrt( (32 M_b/Ï€)Â² + 3 (16 T/Ï€)Â² )
      const C = Math.sqrt(
        Math.pow(32 * M_b_Nmm / Math.PI, 2) +
        3 * Math.pow(16 * T_Nmm / Math.PI, 2)
      );

      const d_vm = Math.cbrt(C / sigma_v_zul); // [mm]

      // nur Torsion zum Vergleich:
      const d_torsion = Math.cbrt((16 * T_Nmm) / (Math.PI * (0.6 * sigma_v_zul)));

      // Normdurchmesser runden
      const pref = [15, 17, 20, 25, 30, 35, 40, 45, 50];
      let d_empf = d_vm;
      for (let p of pref) {
        if (d_vm <= p) { d_empf = p; break; }
      }
      if (d_empf < d_vm) d_empf = d_vm;

      let rating;
      const ausl = d_vm / d_empf;
      if (ausl < 0.6) rating = `<span class="pill-ok">âœ… Deutlich auf der sicheren Seite.</span>`;
      else if (ausl < 0.9) rating = `<span class="pill-ok">âœ… Sinnvoll ausgelastet.</span>`;
      else rating = `<span class="pill-warn">âš ï¸ Sehr hohe Auslastung â€“ nÃ¤chstgrÃ¶ÃŸeren Durchmesser wÃ¤hlen.</span>`;

      const lager = (d) => {
        if (d <= 20) return "z.B. 6204 / 6205";
        if (d <= 25) return "z.B. 6205";
        if (d <= 30) return "z.B. 6206";
        if (d <= 35) return "z.B. 6207";
        if (d <= 40) return "z.B. 6208";
        if (d <= 50) return "z.B. 6210";
        return "entsprechende Rillenkugellager-Reihe nach DIN wÃ¤hlen";
      };

      document.getElementById('shaft-result').innerHTML = `
        Eingaben: T = ${T_Nm.toFixed(1)} Nm,
        ${M_b_Nmm ? `M_b â‰ˆ ${(M_b_Nmm/1000).toFixed(1)} Nm (aus F_t & a)` : "kein Biegemoment angegeben"}<br><br>
        Erforderlicher Durchmesser aus Ïƒ_v (Torsion + Biegung):<br>
        d_req â‰ˆ <b>${d_vm.toFixed(1)} mm</b><br>
        Nur aus Torsion (Vergleich): d_Torsion â‰ˆ ${d_torsion.toFixed(1)} mm<br>
        Empfohlener Normdurchmesser: <b>${d_empf.toFixed(0)} mm</b><br>
        Lager-Vorschlag: <b>${lager(d_empf)}</b><br><br>
        ${rating}<br><br>
        <b>Formelgrundlage:</b><br>
        Ïƒ_b = 32Â·M_b / (Ï€Â·dÂ³);  Ï„_t = 16Â·T / (Ï€Â·dÂ³)<br>
        Ïƒ_v = âˆš(Ïƒ_bÂ² + 3Â·Ï„_tÂ²) â†’ d = ( âˆš((32M_b/Ï€)Â² + 3(16T/Ï€)Â²) / Ïƒ_v,zul )^(1/3)<br><br>
        <span class="pill-note">
          Vereinfachte Gerade-Welle ohne Kerben, Stufen, Freistiche, Kerbwirkungszahlen, Dauerfestigkeit.
          FÃ¼r echte Getriebeauslegung bitte vollstÃ¤ndige Nachweise fÃ¼hren.
        </span>
      `;
    }

    // ==========================================================
    // ğŸ§· ISO-PASSUNG â€“ H/h (sauber)
    // ==========================================================
    function renderPassung() {
      moduleContainer.innerHTML = `
        <h3>ğŸ§· ISO-Passung (H/h)</h3>
        <div class="hint">
          Loch-Basis-System H/h mit vereinfachter IT-Berechnung.
          Zeigt AbmaÃŸe, Spiel und Passungsart. Bewusst auf H/h begrenzt, damit es fachlich sauber bleibt.
        </div>
        <div class="grid">
          <div class="field">
            <label>Nenndurchmesser D [mm]</label>
            <input id="D_fit" type="number" value="20" />
          </div>
          <div class="field">
            <label>Loch-Toleranz</label>
            <select id="holeTol">
              <option value="H5">H5</option>
              <option value="H6">H6</option>
              <option value="H7" selected>H7</option>
              <option value="H8">H8</option>
              <option value="H9">H9</option>
              <option value="H10">H10</option>
              <option value="H11">H11</option>
            </select>
          </div>
          <div class="field">
            <label>Wellen-Toleranz</label>
            <select id="shaftTol">
              <option value="h5">h5</option>
              <option value="h6" selected>h6</option>
              <option value="h7">h7</option>
              <option value="h8">h8</option>
              <option value="h9">h9</option>
              <option value="h10">h10</option>
              <option value="h11">h11</option>
            </select>
          </div>
        </div>
        <button class="btn-primary" onclick="calcFit()">Passung berechnen</button>
        <div id="fit-result" class="result"></div>
      `;
    }

    function getITmicrons(D, grade) {
      const i = 0.45 * Math.cbrt(D) + 0.001 * D; // Âµm
      const k = { 5:7, 6:10, 7:16, 8:25, 9:40, 10:64, 11:100 }[grade];
      if (!k) return null;
      return k * i;
    }

    function parseTol(str) {
      return { letter: str.charAt(0), grade: parseInt(str.slice(1), 10) };
    }

    function calcFit() {
      const D = parseFloat(document.getElementById('D_fit').value);
      const holeStr = document.getElementById('holeTol').value;
      const shaftStr = document.getElementById('shaftTol').value;

      if (isNaN(D) || D <= 0) {
        document.getElementById('fit-result').innerHTML = "Bitte gÃ¼ltigen Nenndurchmesser eingeben.";
        return;
      }

      const hole = parseTol(holeStr);
      const shaft = parseTol(shaftStr);
      const IT_hole = getITmicrons(D, hole.grade);
      const IT_shaft = getITmicrons(D, shaft.grade);

      if (!IT_hole || !IT_shaft) {
        document.getElementById('fit-result').innerHTML = "Dieser IT-Grad ist in dieser Demo nicht implementiert.";
        return;
      }

      if (hole.letter !== 'H' || shaft.letter !== 'h') {
        document.getElementById('fit-result').innerHTML =
          "Diese Version unterstÃ¼tzt bewusst nur H/h-Kombinationen. Erweiterung auf R/S/U etc. wÃ¤re der nÃ¤chste Norm-Schritt.";
        return;
      }

      const EI_H = 0;
      const ES_H = IT_hole;
      const es_h = 0;
      const ei_h = -IT_shaft;

      const hole_min = D + EI_H / 1000;
      const hole_max = D + ES_H / 1000;
      const shaft_min = D + ei_h / 1000;
      const shaft_max = D + es_h / 1000;

      const c_min = (hole_min - shaft_max) * 1000;
      const c_max = (hole_max - shaft_min) * 1000;

      let typeText;
      if (c_min > 0) typeText = `<span class="pill-ok">âœ… Spielpassung</span>`;
      else if (c_max < 0) typeText = `<span class="pill-warn">âš ï¸ ÃœbermaÃŸpassung</span>`;
      else typeText = `<span class="pill-warn">âš ï¸ Ãœbergangspassung</span>`;

      document.getElementById('fit-result').innerHTML = `
        <b>${holeStr} / ${shaftStr}</b> bei D = ${D.toFixed(2)} mm<br><br>
        Loch: EI = 0 Âµm, ES â‰ˆ +${ES_H.toFixed(0)} Âµm â†’ ${hole_min.toFixed(3)} â€¦ ${hole_max.toFixed(3)} mm<br>
        Welle: ei â‰ˆ ${ei_h.toFixed(0)} Âµm, es = 0 Âµm â†’ ${shaft_min.toFixed(3)} â€¦ ${shaft_max.toFixed(3)} mm<br><br>
        Spiel: c_min â‰ˆ ${c_min.toFixed(0)} Âµm, c_max â‰ˆ ${c_max.toFixed(0)} Âµm<br>
        ${typeText}<br><br>
        <b>Idee dahinter:</b><br>
        IT nach i-Formel, H: EI=0, h: es=0; AbmaÃŸe = D + Abweichung; Spiel = Loch âˆ’ Welle.<br>
        <span class="pill-note">Didaktische NÃ¤herung. FÃ¼r prÃ¤zise Passungen ISO 286 Tabellen verwenden.</span>
      `;
    }

    // ==========================================================
    // ğŸ’° KOSTEN
    // ==========================================================
    function renderKosten() {
      moduleContainer.innerHTML = `
        <h3>ğŸ’° Kostenkalkulator</h3>
        <div class="hint">Einfache Material- und MaschinenkostenabschÃ¤tzung pro Teil.</div>
        <div class="grid">
          <div class="field">
            <label>Bauteilvolumen V [cmÂ³]</label>
            <input id="V_cm3" type="number" value="100" />
          </div>
          <div class="field">
            <label>Ï [g/cmÂ³]</label>
            <input id="rho_mat" type="number" value="7.85" />
          </div>
          <div class="field">
            <label>Materialpreis [â‚¬/kg]</label>
            <input id="c_mat" type="number" value="2.0" />
          </div>
          <div class="field">
            <label>Bearbeitungszeit je Teil [min]</label>
            <input id="t_min" type="number" value="10" />
          </div>
          <div class="field">
            <label>Maschinenstundensatz [â‚¬/h]</label>
            <input id="c_h" type="number" value="60" />
          </div>
          <div class="field">
            <label>StÃ¼ckzahl</label>
            <input id="n_stk" type="number" value="10" />
          </div>
        </div>
        <button class="btn-primary" onclick="calcCost()">Berechnen</button>
        <div id="cost-result" class="result"></div>
      `;
    }

    function calcCost() {
      const V = parseFloat(document.getElementById('V_cm3').value);
      const rho = parseFloat(document.getElementById('rho_mat').value);
      const c_mat = parseFloat(document.getElementById('c_mat').value);
      const t_min = parseFloat(document.getElementById('t_min').value);
      const c_h = parseFloat(document.getElementById('c_h').value);
      const n = parseFloat(document.getElementById('n_stk').value);

      if ([V,rho,c_mat,t_min,c_h,n].some(v => isNaN(v) || v < 0)) {
        document.getElementById('cost-result').innerHTML = "Bitte sinnvolle Werte eingeben.";
        return;
      }

      const m_kg = V * rho / 1000;
      const K_mat = m_kg * c_mat;
      const K_fert = (t_min / 60) * c_h;
      const K_teil = K_mat + K_fert;
      const K_ges = K_teil * n;

      document.getElementById('cost-result').innerHTML = `
        Masse je Teil m â‰ˆ <b>${m_kg.toFixed(3)} kg</b><br>
        Materialkosten je Teil â‰ˆ <b>${K_mat.toFixed(2)} â‚¬</b><br>
        Fertigungskosten je Teil â‰ˆ <b>${K_fert.toFixed(2)} â‚¬</b><br>
        Gesamtkosten je Teil â‰ˆ <b>${K_teil.toFixed(2)} â‚¬</b><br>
        Gesamtkosten fÃ¼r ${n} StÃ¼ck â‰ˆ <b>${K_ges.toFixed(2)} â‚¬</b><br><br>
        <b>Formeln:</b><br>
        m = VÂ·Ï / 1000<br>
        K_mat = mÂ·c_mat;  K_fert = (t_min/60)Â·c_h<br>
        K_teil = K_mat + K_fert;  K_ges = K_teilÂ·n<br>
      `;
    }

    // ==========================================================
    // ğŸ”¥ WÃ„RMEÃœBERTRAGUNG
    // ==========================================================
    function renderWaerme() {
      moduleContainer.innerHTML = `
        <h3>ğŸ”¥ WÃ¤rmeÃ¼bertragung</h3>
        <div class="hint">
          Einlagige Wand mit Konvektion innen/auÃŸen. U-Wert und stationÃ¤rer WÃ¤rmestrom.
        </div>
        <div class="grid">
          <div class="field">
            <label>T<sub>i</sub> innen [Â°C]</label>
            <input id="Ti" type="number" value="20" />
          </div>
          <div class="field">
            <label>T<sub>o</sub> auÃŸen [Â°C]</label>
            <input id="To" type="number" value="0" />
          </div>
          <div class="field">
            <label>Wanddicke Î´ [m]</label>
            <input id="delta" type="number" step="0.01" value="0.2" />
          </div>
          <div class="field">
            <label>Î» [W/mK]</label>
            <input id="lambda" type="number" step="0.01" value="0.2" />
          </div>
          <div class="field">
            <label>h<sub>i</sub> innen [W/mÂ²K]</label>
            <input id="hi" type="number" value="8" />
          </div>
          <div class="field">
            <label>h<sub>o</sub> auÃŸen [W/mÂ²K]</label>
            <input id="ho" type="number" value="20" />
          </div>
          <div class="field">
            <label>FlÃ¤che A [mÂ²]</label>
            <input id="A" type="number" value="10" />
          </div>
        </div>
        <button class="btn-primary" onclick="calcHeat()">Berechnen</button>
        <div id="heat-result" class="result"></div>
      `;
    }

    function calcHeat() {
      const Ti = parseFloat(document.getElementById('Ti').value);
      const To = parseFloat(document.getElementById('To').value);
      const delta = parseFloat(document.getElementById('delta').value);
      const lambda = parseFloat(document.getElementById('lambda').value);
      const hi = parseFloat(document.getElementById('hi').value);
      const ho = parseFloat(document.getElementById('ho').value);
      const A = parseFloat(document.getElementById('A').value);

      if ([Ti,To,delta,lambda,hi,ho,A].some(v => isNaN(v) || v <= 0)) {
        document.getElementById('heat-result').innerHTML = "Bitte alle Werte > 0 eingeben.";
        return;
      }

      const Rsi = 1 / hi;
      const Rse = 1 / ho;
      const Rw = delta / lambda;
      const Rtot = Rsi + Rw + Rse;
      const U = 1 / Rtot;
      const dT = Ti - To;
      const Q = U * A * dT;

      document.getElementById('heat-result').innerHTML = `
        U â‰ˆ <b>${U.toFixed(3)} W/mÂ²K</b><br>
        Q â‰ˆ <b>${Q.toFixed(1)} W</b> bei Î”T = ${dT.toFixed(1)} K<br><br>
        <b>Formeln:</b><br>
        R_si = 1/h_i;  R_se = 1/h_o;  R_w = Î´/Î»<br>
        R_tot = R_si + R_w + R_se;  U = 1/R_tot<br>
        Q = U Â· A Â· (T_i âˆ’ T_o)<br>
      `;
    }

    // ==========================================================
    // NAVIGATION
    // ==========================================================
    function setActive(btn) {
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    document.querySelectorAll('nav button').forEach(btn => {
      btn.addEventListener('click', () => {
        const mod = btn.dataset.module;
        setActive(btn);
        if (mod === 'schraube') renderSchraubenrechner();
        else if (mod === 'balken') renderBalken();
        else if (mod === 'werkstoff') renderWerkstoffvergleich();
        else if (mod === 'welle') renderWelle();
        else if (mod === 'passung') renderPassung();
        else if (mod === 'kosten') renderKosten();
        else if (mod === 'waerme') renderWaerme();
      });
    });

    // Startmodul
    renderSchraubenrechner();
  </script>
</body>
</html>

